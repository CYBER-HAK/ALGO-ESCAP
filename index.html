<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALGO ESCAPE</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #121212;
  color: white;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  margin-top: 30px;
  font-size: 2.8em;
  text-shadow: 0 0 15px #00ffaa;
}

#storyBox {
  width:80%;
  margin-top:20px;
  background:#141414;
  padding:20px;
  border-radius:12px;
  font-size:1.2em;
  text-align:center;
  display:block;
}

#levelInfo, #stats {
  margin:15px;
  padding:10px 20px;
  background:#222;
  border-radius:10px;
  font-size:1.2em;
}

#feed {
  width:380px;
  margin-top:20px;
}

.post {
  background:#252525;
  margin:15px 0;
  padding:15px;
  border-radius:10px;
  cursor:pointer;
  border-left:5px solid #00ffaa33;
  transition:0.2s;
}
.post:hover { background:#303030; transform:scale(1.03); }

#powerUpBtn {
  margin-top:20px;
  padding:10px 20px;
  background:#00ffaa;
  color:#000;
  border:none;
  border-radius:10px;
  font-size:1.1em;
  cursor:pointer;
}

#minigameBox {
  margin-top:20px;
  padding:20px;
  width:80%;
  background:#121212;
  border-radius:15px;
  display:none;
  text-align:center;
}

.miniBtn {
  margin:10px;
  padding:12px 25px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-size:1.1em;
  background:#00ffaa;
  color:black;
  transition:0.2s;
}
.miniBtn:hover { transform:scale(1.1); }

#winScreen {
  display:none;
  margin-top:40px;
  font-size:2em;
  color:#00ff9d;
  text-align:center;
}
</style>
</head>
<body>

<h1>ALGO ESCAPE</h1>
<div id="storyBox"></div>
<div id="levelInfo"></div>
<div id="stats">Filterblase: <span id="bubbleValue">80</span>%</div>
<button id="powerUpBtn">ðŸ”§ Power-Up einsetzen</button>
<div id="minigameBox"></div>
<div id="feed"></div>
<div id="winScreen"></div>

<script>
let bubble = 80;
let level = 1;
let clickCount = 0; // ZÃ¤hlt Post-Klicks fÃ¼r zufÃ¤llige Minigames

const bubbleValue = document.getElementById("bubbleValue");
const levelInfo = document.getElementById("levelInfo");
const storyBox = document.getElementById("storyBox");
const feed = document.getElementById("feed");
const minigameBox = document.getElementById("minigameBox");
const winScreen = document.getElementById("winScreen");
const powerUpBtn = document.getElementById("powerUpBtn");

// Storytexte
const levels = {
  1: { story:"Level 1: Dein Feed wirkt einseitig. Alles wiederholt sich..." },
  2: { story:"Level 2: Der Algorithmus setzt auf starke Emotionen..." },
  3: { story:"Finales Level! Nur ein Minigame kann dich befreien..." }
};

// 60 verschiedene Posts pro Level
const levelPosts = {
  1: Array.from({length:60},(_,i)=>({text:`Level 1 Post ${i+1}`, effect: i%2===0 ? 10 : -15})),
  2: Array.from({length:60},(_,i)=>({text:`Level 2 Post ${i+1}`, effect: i%3===0 ? 20 : -15})),
  3: [] // Nur Minigames
};

let postPool = [];
let currentPosts = [];

// Minigames
const minigames = {
  1: [
    () => {
      minigameBox.style.display="block";
      minigameBox.innerHTML="<h2>Finde den echten Post!</h2>";
      const options = ["Fake-News","Clickbait","Neutral","ReiÃŸerisch"];
      const correct=2;
      options.forEach((opt,i)=>{
        const btn=document.createElement("button");
        btn.className="miniBtn"; btn.textContent=opt;
        btn.onclick=()=> i===correct ? showWin() : showGameOver();
        minigameBox.appendChild(btn);
      });
    },
    () => {
      minigameBox.style.display="block";
      minigameBox.innerHTML="<h2>Klicke 5Ã— in 5 Sekunden!</h2>";
      let count=0;
      const btn=document.createElement("button");
      btn.className="miniBtn"; btn.textContent="KLICK!";
      btn.onclick=()=>{
        count++;
        btn.textContent=`KLICK! (${count}/5)`;
        if(count>=5) showWin();
      };
      minigameBox.appendChild(btn);
      setTimeout(()=>{if(count<5) showGameOver();},5000);
    }
  ],
  2: [
    () => {
      minigameBox.style.display="block";
      minigameBox.innerHTML="<h2>Klicke 7Ã— in 7 Sekunden!</h2>";
      let count=0;
      const btn=document.createElement("button");
      btn.className="miniBtn"; btn.textContent="KLICK!";
      btn.onclick=()=>{
        count++; btn.textContent=`KLICK! (${count}/7)`; if(count>=7) showWin();
      };
      minigameBox.appendChild(btn);
      setTimeout(()=>{if(count<7) showGameOver();},7000);
    },
    () => {
      minigameBox.style.display="block";
      minigameBox.innerHTML="<h2>Finde 2 echte Posts!</h2>";
      const options = ["Clickbait","Neutral","Neutral","Fake-News"];
      const correct = [1,2]; let selected=0;
      options.forEach((opt,i)=>{
        const btn=document.createElement("button");
        btn.className="miniBtn"; btn.textContent=opt;
        btn.onclick=()=>{
          if(correct.includes(i)){ selected++; if(selected===2) showWin(); }
          else showGameOver();
        };
        minigameBox.appendChild(btn);
      });
    }
  ],
  3: [
    () => {
      minigameBox.style.display="block";
      minigameBox.innerHTML="<h2>Klicke 10Ã— in 10 Sekunden!</h2>";
      let count=0; const btn=document.createElement("button");
      btn.className="miniBtn"; btn.textContent="KLICK!";
      btn.onclick=()=>{
        count++; btn.textContent=`KLICK! (${count}/10)`; if(count>=10) showWin();
      };
      minigameBox.appendChild(btn);
      setTimeout(()=>{if(count<10) showGameOver();},10000);
    }
  ]
};

// Funktionen
function initPostPool(){
  postPool = [...levelPosts[level]];
}

function startLevel(){
  clickCount=0;
  storyBox.textContent = levels[level].story;
  levelInfo.textContent = "Level "+level;
  bubbleValue.textContent = bubble;
  powerUpBtn.style.display="block";
  powerUpBtn.disabled=false;
  powerUpBtn.textContent="ðŸ”§ Power-Up einsetzen";
  minigameBox.style.display="none";
  feed.style.display="block";
  initPostPool();
  generateFeed();
}

// 3 Posts ziehen
function generateFeed(){
  if(postPool.length<3) initPostPool();
  feed.innerHTML="";
  currentPosts=[];
  let usedIndices=[];
  while(currentPosts.length<3){
    let idx=Math.floor(Math.random()*postPool.length);
    if(!usedIndices.includes(idx)){
      currentPosts.push(postPool[idx]);
      usedIndices.push(idx);
    }
  }
  currentPosts.forEach(post=>{
    const div=document.createElement("div");
    div.className="post";
    div.textContent=post.text;
    div.addEventListener("click",()=>handlePostClick(post));
    feed.appendChild(div);
  });
}

powerUpBtn.addEventListener("click",()=>{
  bubble-=25;
  bubble=Math.max(0,bubble);
  bubbleValue.textContent=bubble;
  powerUpBtn.disabled=true;
  powerUpBtn.textContent="Power-Up benutzt!";
  checkProgress();
});

function handlePostClick(post){
  bubble+=post.effect;
  bubble=Math.min(100,Math.max(0,bubble));
  bubbleValue.textContent=bubble;
  clickCount++;
  
  // ZufÃ¤lliges Minigame nach 2-4 Klicks
  if(clickCount===2+Math.floor(Math.random()*3)){
    startRandomMinigame();
  } else {
    generateFeed();
  }
  
  checkProgress();
}

function checkProgress(){
  if(bubble>=100) showGameOver();
  else if(bubble<=0) nextLevel();
}

function nextLevel(){
  level++;
  bubble=80;
  if(level>3){ showFinalWin(); return; }
  startLevel();
}

function startRandomMinigame(){
  feed.style.display="none";
  minigameBox.style.display="block";
  let options=minigames[level];
  let pick=options[Math.floor(Math.random()*options.length)];
  pick();
}

function showWin(){
  minigameBox.style.display="none";
  feed.style.display="block";
  generateFeed();
}

function showGameOver(){
  feed.style.display="none";
  minigameBox.style.display="none";
  storyBox.innerHTML="<h2 style='color:red;'>GAME OVER â€“ der Algorithmus hat dich eingeschlossen!</h2>";
  setTimeout(()=>{
    level=1; bubble=80; startLevel();
  },2000);
}

function showFinalWin(){
  winScreen.style.display="block";
  winScreen.innerHTML="ðŸŽ‰ <br><br><strong>DU BIST ENTKOMMEN!</strong><br><br>Der Algorithmus hat keine Macht mehr Ã¼ber dich.";
}

startLevel();
</script>
</body>
</html>
