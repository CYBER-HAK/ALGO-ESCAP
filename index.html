<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALGO ESCAPE</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #121212; /* Einfarbiger Hintergrund */
    color: white;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  h1 {
    margin-top: 30px;
    font-size: 2.8em;
    text-shadow: 0 0 15px #00ffaa;
    animation: fadeIn 1s ease;
  }

  .fadeIn { animation: fadeIn 0.8s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }

  .levelTransition {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:black;
    display:none;
    justify-content:center;
    align-items:center;
    font-size:3em;
    color:#00ffaa;
    animation:fadeIn 1s forwards;
    z-index:999;
  }

  #storyBox {
    width:80%;
    margin-top:20px;
    background:#141414;
    padding:20px;
    border-radius:12px;
    font-size:1.2em;
    text-align:center;
    display:none;
  }

  #levelInfo, #stats {
    margin:15px;
    padding:10px 20px;
    background:#222;
    border-radius:10px;
    font-size:1.2em;
  }

  #feed {
    width:380px;
    margin-top:20px;
  }

  .post {
    background:#252525;
    margin:15px 0;
    padding:15px;
    border-radius:10px;
    cursor:pointer;
    border-left:5px solid #00ffaa33;
    transition:0.2s;
  }
  .post:hover { background:#303030; transform:scale(1.03); }

  #powerUpBtn {
    margin-top:20px;
    padding:10px 20px;
    background:#00ffaa;
    color:#000;
    border:none;
    border-radius:10px;
    font-size:1.1em;
    cursor:pointer;
    display:none;
  }

  #minigameBox {
    margin-top:20px;
    padding:20px;
    width:80%;
    background:#121212;
    border-radius:15px;
    display:none;
    text-align:center;
  }

  .miniBtn {
    margin:10px;
    padding:12px 25px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-size:1.1em;
    background:#00ffaa;
    color:black;
    transition:0.2s;
  }
  .miniBtn:hover { transform:scale(1.1); }

  #winScreen {
    display:none;
    margin-top:40px;
    font-size:2em;
    color:#00ff9d;
    text-align:center;
  }
</style>
</head>
<body>

<div id="transition" class="levelTransition">LEVEL START</div>
<h1>ALGO ESCAPE</h1>
<div id="storyBox"></div>
<div id="levelInfo"></div>
<div id="stats">Filterblase: <span id="bubbleValue">80</span>%</div>
<button id="powerUpBtn">ðŸ”§ Power-Up einsetzen</button>
<div id="minigameBox"></div>
<div id="feed"></div>
<div id="winScreen"></div>

<script>
let bubble = 80;
let level = 1;

const bubbleValue = document.getElementById("bubbleValue");
const levelInfo = document.getElementById("levelInfo");
const storyBox = document.getElementById("storyBox");
const feed = document.getElementById("feed");
const minigameBox = document.getElementById("minigameBox");
const winScreen = document.getElementById("winScreen");
const powerUpBtn = document.getElementById("powerUpBtn");
const transition = document.getElementById("transition");

// Minigames fÃ¼r jedes Level
const minigames = {
  1: [
    () => {
      minigameBox.innerHTML = "<h2>Finde den echten Post!</h2>";
      let options = ["Fake-News-Beitrag", "Clickbait", "Neutraler Informationspost", "ReiÃŸerische Ãœberschrift"];
      let correct = 2;
      options.forEach((opt, i) => {
        let btn = document.createElement("button");
        btn.className = "miniBtn";
        btn.textContent = opt;
        btn.onclick = () => i===correct ? showWin() : showGameOver();
        minigameBox.appendChild(btn);
      });
    },
    () => {
      minigameBox.innerHTML = "<h2>Klicke 5Ã— in 5 Sekunden!</h2>";
      let count = 0;
      let btn = document.createElement("button");
      btn.className = "miniBtn";
      btn.textContent = "KLICK!";
      btn.onclick = () => { count++; btn.textContent=`KLICK! (${count}/5)`; if(count>=5) showWin(); };
      minigameBox.appendChild(btn);
      setTimeout(()=>{ if(count<5) showGameOver(); }, 5000);
    }
  ],
  2: [
    () => {
      minigameBox.innerHTML = "<h2>Klicke 7Ã— in 7 Sekunden!</h2>";
      let count = 0;
      let btn = document.createElement("button");
      btn.className = "miniBtn";
      btn.textContent="KLICK!";
      btn.onclick=()=>{count++; btn.textContent=`KLICK! (${count}/7)`; if(count>=7) showWin();};
      minigameBox.appendChild(btn);
      setTimeout(()=>{ if(count<7) showGameOver(); }, 7000);
    },
    () => {
      minigameBox.innerHTML = "<h2>Finde 2 echte Posts!</h2>";
      let options = ["Clickbait", "Neutral", "Neutral", "Fake-News"];
      let correct = [1,2];
      let selected=0;
      options.forEach((opt,i)=>{
        let btn=document.createElement("button");
        btn.className="miniBtn";
        btn.textContent=opt;
        btn.onclick=()=>{
          if(correct.includes(i)){
            selected++;
            if(selected===2) showWin();
          } else showGameOver();
        };
        minigameBox.appendChild(btn);
      });
    }
  ],
  3: [
    () => {
      minigameBox.innerHTML = "<h2>Klicke 10Ã— in 10 Sekunden!</h2>";
      let count=0;
      let btn=document.createElement("button");
      btn.className="miniBtn";
      btn.textContent="KLICK!";
      btn.onclick=()=>{count++; btn.textContent=`KLICK! (${count}/10)`; if(count>=10) showWin();};
      minigameBox.appendChild(btn);
      setTimeout(()=>{ if(count<10) showGameOver(); }, 10000);
    },
    () => {
      minigameBox.innerHTML="<h2>Finde 3 echte Posts!</h2>";
      let options=["Clickbait","Neutral","Neutral","Neutral","Fake-News"];
      let correct=[1,2,3];
      let selected=0;
      options.forEach((opt,i)=>{
        let btn=document.createElement("button");
        btn.className="miniBtn";
        btn.textContent=opt;
        btn.onclick=()=>{
          if(correct.includes(i)){
            selected++;
            if(selected===3) showWin();
          } else showGameOver();
        };
        minigameBox.appendChild(btn);
      });
    }
  ]
};

// Levels mit Schwierigkeitsgrad
const levels = {
  1: {
    story:"Level 1: Dein Feed wirkt einseitig. Alles wiederholt sich...",
    posts:[
      {text:"Ein Meme, das du schon hundertmal gesehen hast.", type:"same", effect:10},
      {text:"Ein belangloser Clip ohne Inhalt.", type:"same", effect:10},
      {text:"Ein informativer Lernbeitrag.", type:"break", effect:-15},
      {text:"Ein sachlicher Post Ã¼ber ein neues Thema.", type:"break", effect:-15}
    ]
  },
  2: {
    story:"Level 2: Der Algorithmus setzt auf starke Emotionen...",
    posts:[
      {text:"EmpÃ¶rungspost: 'Das ist einfach unglaublich!'", type:"controversial", effect:20},
      {text:"Clickbait: 'Du wirst NICHT glauben, was als NÃ¤chstes passiert!'", type:"controversial", effect:20},
      {text:"Ein ruhiger Informationsartikel.", type:"break", effect:-15},
      {text:"Ein objektiver Nachrichtenausschnitt.", type:"break", effect:-15}
    ]
  },
  3: {
    story:"Finales Level! Nur ein Minigame kann dich befreien...",
    posts:[]
  }
};

function startLevel(){
  transition.style.display="flex";
  transition.textContent="LEVEL "+level;
  setTimeout(()=>transition.style.display="none",1200);
  let data=levels[level];
  storyBox.style.display="block";
  storyBox.textContent=data.story;
  levelInfo.textContent="Level "+level;

  if(level===3){
    feed.style.display="none";
    startRandomMinigame();
    return;
  }

  generateFeed();
  powerUpBtn.style.display="block";
  powerUpBtn.disabled=false;
  powerUpBtn.textContent="ðŸ”§ Power-Up einsetzen";
}

function generateFeed(){
  let posts=[...levels[level].posts];
  feed.innerHTML="";
  feed.style.display="block";

  for(let i=posts.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [posts[i],posts[j]]=[posts[j],posts[i]];
  }

  posts.forEach(post=>{
    let div=document.createElement("div");
    div.className="post fadeIn";
    div.textContent=post.text;
    div.addEventListener("click",()=>handlePostClick(post));
    feed.appendChild(div);
  });
}

powerUpBtn.addEventListener("click",()=>{
  bubble-=25;
  bubble=Math.max(0,bubble);
  bubbleValue.textContent=bubble;
  powerUpBtn.disabled=true;
  powerUpBtn.textContent="Power-Up benutzt!";
  checkProgress();
});

function handlePostClick(post){
  bubble+=post.effect;
  bubble=Math.min(100,Math.max(0,bubble));
  bubbleValue.textContent=bubble;
  generateFeed(); // Posts erneuern nach Klick
  checkProgress();
}

function checkProgress(){
  if(bubble>=100){
    showGameOver();
  } else if(bubble<=0){
    nextLevel();
  }
}

function nextLevel(){
  level++;
  bubble=80;
  bubbleValue.textContent=bubble;
  if(level>3){
    showFinalWin();
    return;
  }
  feed.style.display="none";
  minigameBox.style.display="none";
  setTimeout(startLevel,500);
}

function startRandomMinigame(){
  minigameBox.style.display="block";
  let options=minigames[level];
  let pick=options[Math.floor(Math.random()*options.length)];
  pick();
}

function showWin(){
  minigameBox.innerHTML="<h2>âœ” Du hast das Minigame gewonnen!</h2>";
  setTimeout(nextLevel,1200);
}

function showGameOver(){
  feed.style.display="none";
  minigameBox.style.display="none";
  storyBox.innerHTML="<h2 style='color:red;'>GAME OVER â€“ der Algorithmus hat dich komplett eingeschlossen!</h2>";
  setTimeout(()=>{
    level=1;
    bubble=80;
    bubbleValue.textContent=bubble;
    startLevel();
  },2000);
}

function showFinalWin(){
  winScreen.style.display="block";
  winScreen.innerHTML="ðŸŽ‰ <br><br><strong>DU BIST ENTKOMMEN!</strong><br><br>Der Algorithmus hat keine Macht mehr Ã¼ber dich.";
}

startLevel();
</script>
</body>
</html>
